{{ template "head" .}}
<body class="bg-gray-50">
<!-- Navbar wie in vorherigem Code -->
{{ template "navigation" .}}
<!-- Hauptinhalt -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="md:flex md:items-center md:justify-between mb-6">
        <div class="flex-1 min-w-0">
            <h1 class="text-2xl font-bold text-gray-900">Fahrzeuge</h1>
        </div>
        <div class="mt-4 md:mt-0">
            <button id="add-vehicle-btn" type="button" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                <svg class="-ml-1 mr-2 h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                </svg>
                Fahrzeug hinzufügen
            </button>
        </div>
    </div>

    <!-- Filter und Suche -->
    <div class="bg-white p-4 rounded-md shadow-sm mb-6">
        <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4">
            <div class="flex-1">
                <label for="search" class="sr-only">Suche</label>
                <div class="relative rounded-md shadow-sm">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <svg class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </div>
                    <input type="text" name="search" id="search" class="focus:ring-indigo-500 focus:border-indigo-500 block w-full pl-10 pr-12 sm:text-sm border-gray-300 rounded-md" placeholder="Fahrzeug suchen...">
                </div>
            </div>
            <div class="sm:w-1/4">
                <select id="status-filter" class="block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    <option value="all">Alle Status</option>
                    <option value="available">Verfügbar</option>
                    <option value="inuse">In Benutzung</option>
                    <option value="maintenance">In Wartung</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Fahrzeug-Grid -->
    <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
        <!-- Fahrzeug-Karte 1 -->
        <div class="bg-white overflow-hidden shadow rounded-lg">
            <div class="p-5">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg leading-6 font-medium text-gray-900">VW Passat</h3>
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                Verfügbar
            </span>
                </div>
                <div class="mt-3 grid grid-cols-3 gap-3 text-sm text-gray-500">
                    <div>
                        <span class="block font-medium text-gray-700">Kennzeichen</span>
                        <span>M-AB 1234</span>
                    </div>
                    <div>
                        <span class="block font-medium text-gray-700">Baujahr</span>
                        <span>2022</span>
                    </div>
                    <div>
                        <span class="block font-medium text-gray-700">Fahrer</span>
                        <span>Nicht zugewiesen</span>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-200 px-5 py-3 bg-gray-50 flex justify-end space-x-3">
                <button type="button" class="edit-vehicle-btn inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" data-id="1">
                    <svg class="-ml-0.5 mr-1 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                    </svg>
                    Bearbeiten
                </button>
                <a href="/vehicle-details/1" class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded text-indigo-700 bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    <svg class="-ml-0.5 mr-1 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                    </svg>
                    Details
                </a>
            </div>
        </div>

        <!-- Fahrzeug-Karte 2 -->
        <div class="bg-white overflow-hidden shadow rounded-lg">
            <div class="p-5">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg leading-6 font-medium text-gray-900">BMW 530e</h3>
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
              In Benutzung
            </span>
                </div>
                <div class="mt-3 grid grid-cols-3 gap-3 text-sm text-gray-500">
                    <div>
                        <span class="block font-medium text-gray-700">Kennzeichen</span>
                        <span>M-CD 5678</span>
                    </div>
                    <div>
                        <span class="block font-medium text-gray-700">Baujahr</span>
                        <span>2023</span>
                    </div>
                    <div>
                        <span class="block font-medium text-gray-700">Fahrer</span>
                        <span>Max Mustermann</span>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-200 px-5 py-3 bg-gray-50 flex justify-end space-x-3">
                <button type="button" class="edit-vehicle-btn inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" data-id="2">
                    <svg class="-ml-0.5 mr-1 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                    </svg>
                    Bearbeiten
                </button>
                <button type="button" class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded text-indigo-700 bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    <svg class="-ml-0.5 mr-1 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                    </svg>
                    Details
                </button>
            </div>
        </div>

        <!-- Fahrzeug-Karte 3 -->
        <div class="bg-white overflow-hidden shadow rounded-lg">
            <div class="p-5">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg leading-6 font-medium text-gray-900">Audi e-tron</h3>
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
              In Wartung
            </span>
                </div>
                <div class="mt-3 grid grid-cols-3 gap-3 text-sm text-gray-500">
                    <div>
                        <span class="block font-medium text-gray-700">Kennzeichen</span>
                        <span>M-EF 9012</span>
                    </div>
                    <div>
                        <span class="block font-medium text-gray-700">Baujahr</span>
                        <span>2023</span>
                    </div>
                    <div>
                        <span class="block font-medium text-gray-700">Fahrer</span>
                        <span>Erika Musterfrau</span>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-200 px-5 py-3 bg-gray-50 flex justify-end space-x-3">
                <button type="button" class="edit-vehicle-btn inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" data-id="3">
                    <svg class="-ml-0.5 mr-1 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                    </svg>
                    Bearbeiten
                </button>
                <button type="button" class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded text-indigo-700 bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    <svg class="-ml-0.5 mr-1 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                    </svg>
                    Details
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Fahrzeug hinzufügen/bearbeiten -->
<div id="vehicle-modal" class="fixed z-10 inset-0 overflow-y-auto hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <!-- Hintergrund-Overlay -->
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>

        <!-- Zentriert den Modal-Inhalt -->
        <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

        <!-- Modal-Panel -->
        <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-3xl sm:w-full">
            <form id="vehicle-form">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="w-full">
                            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">
                                Fahrzeug hinzufügen
                            </h3>

                            <!-- Tabs für die verschiedenen Bereiche -->
                            <div class="mt-4 border-b border-gray-200">
                                <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                                    <button type="button" class="tab-btn border-indigo-500 text-indigo-600 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="vehicle-data">
                                        Fahrzeugdaten
                                    </button>
                                    <button type="button" class="tab-btn border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="registration-data">
                                        Zulassung & Versicherung
                                    </button>
                                    <button type="button" class="tab-btn border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="driver-assignment">
                                        Fahrerzuordnung
                                    </button>
                                </nav>
                            </div>

                            <!-- Tab-Inhalte -->
                            <div class="py-5">
                                <!-- Tab 1: Fahrzeugdaten -->
                                <div id="vehicle-data" class="tab-content">
                                    <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">
                                        <div class="sm:col-span-3">
                                            <label for="brand" class="block text-sm font-medium text-gray-700">Marke</label>
                                            <input type="text" name="brand" id="brand" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                        </div>

                                        <div class="sm:col-span-3">
                                            <label for="model" class="block text-sm font-medium text-gray-700">Modell</label>
                                            <input type="text" name="model" id="model" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                        </div>

                                        <div class="sm:col-span-2">
                                            <label for="year" class="block text-sm font-medium text-gray-700">Baujahr</label>
                                            <input type="number" name="year" id="year" min="1900" max="2099" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                        </div>

                                        <div class="sm:col-span-2">
                                            <label for="license" class="block text-sm font-medium text-gray-700">Kennzeichen</label>
                                            <input type="text" name="license" id="license" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                        </div>

                                        <div class="sm:col-span-2">
                                            <label for="color" class="block text-sm font-medium text-gray-700">Farbe</label>
                                            <input type="text" name="color" id="color" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                        </div>

                                        <div class="sm:col-span-3">
                                            <label for="vin" class="block text-sm font-medium text-gray-700">Fahrzeug-Identifikationsnummer (VIN)</label>
                                            <input type="text" name="vin" id="vin" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                        </div>

                                        <div class="sm:col-span-3">
                                            <label for="mileage" class="block text-sm font-medium text-gray-700">Kilometerstand</label>
                                            <div class="mt-1 relative rounded-md shadow-sm">
                                                <input type="number" name="mileage" id="mileage" class="focus:ring-indigo-500 focus:border-indigo-500 block w-full pr-12 sm:text-sm border-gray-300 rounded-md" placeholder="0">
                                                <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                                    <span class="text-gray-500 sm:text-sm">km</span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="sm:col-span-3">
                                            <label for="status" class="block text-sm font-medium text-gray-700">Status</label>
                                            <select id="status" name="status" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                                <option value="available">Verfügbar</option>
                                                <option value="inuse">In Benutzung</option>
                                                <option value="maintenance">In Wartung</option>
                                            </select>
                                        </div>

                                        <div class="sm:col-span-3">
                                            <label for="fuel-type" class="block text-sm font-medium text-gray-700">Kraftstoffart</label>
                                            <select id="fuel-type" name="fuel-type" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                                <option value="diesel">Diesel</option>
                                                <option value="gasoline">Benzin</option>
                                                <option value="electric">Elektro</option>
                                                <option value="hybrid">Hybrid</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <!-- Tab 2: Zulassung & Versicherung -->
                                <div id="registration-data" class="tab-content hidden">
                                    <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">
                                        <div class="sm:col-span-3">
                                            <label for="registration-date" class="block text-sm font-medium text-gray-700">Zulassungsdatum</label>
                                            <input type="date" name="registration-date" id="registration-date" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                        </div>

                                        <div class="sm:col-span-3">
                                            <label for="registration-expiry" class="block text-sm font-medium text-gray-700">Ablaufdatum der Zulassung</label>
                                            <input type="date" name="registration-expiry" id="registration-expiry" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                        </div>

                                        <div class="sm:col-span-3">
                                            <label for="insurance-company" class="block text-sm font-medium text-gray-700">Versicherungsgesellschaft</label>
                                            <input type="text" name="insurance-company" id="insurance-company" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                        </div>

                                        <div class="sm:col-span-3">
                                            <label for="insurance-policy" class="block text-sm font-medium text-gray-700">Versicherungspolice-Nr.</label>
                                            <input type="text" name="insurance-policy" id="insurance-policy" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                        </div>

                                        <div class="sm:col-span-3">
                                            <label for="insurance-type" class="block text-sm font-medium text-gray-700">Versicherungstyp</label>
                                            <select id="insurance-type" name="insurance-type" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                                <option value="Haftpflicht">Haftpflicht</option>
                                                <option value="Vollkasko">Vollkasko</option>
                                                <option value="Teilkasko">Teilkasko</option>
                                            </select>
                                        </div>

                                        <div class="sm:col-span-3">
                                            <label for="insurance-expiry" class="block text-sm font-medium text-gray-700">Ablaufdatum der Versicherung</label>
                                            <input type="date" name="insurance-expiry" id="insurance-expiry" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                        </div>

                                        <div class="sm:col-span-3">
                                            <label for="next-inspection" class="block text-sm font-medium text-gray-700">Nächste HU/AU</label>
                                            <input type="date" name="next-inspection" id="next-inspection" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                        </div>
                                    </div>
                                </div>

                                <!-- Tab 3: Fahrerzuordnung -->
                                <div id="driver-assignment" class="tab-content hidden">
                                    <div class="mt-2">
                                        <label for="assigned-driver" class="block text-sm font-medium text-gray-700">Zugewiesener Fahrer</label>
                                        <select id="assigned-driver" name="assigned-driver" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                            <option value="">Keinen Fahrer zuweisen</option>
                                            <option value="1">Max Mustermann</option>
                                            <option value="2">Erika Musterfrau</option>
                                            <option value="3">John Doe</option>
                                        </select>
                                    </div>

                                    <div class="mt-6">
                                        <fieldset>
                                            <legend class="text-base font-medium text-gray-900">Nutzungsbeschränkungen</legend>
                                            <div class="mt-4 space-y-4">
                                                <div class="flex items-start">
                                                    <div class="flex items-center h-5">
                                                        <input id="restricted-use" name="restricted-use" type="checkbox" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded">
                                                    </div>
                                                    <div class="ml-3 text-sm">
                                                        <label for="restricted-use" class="font-medium text-gray-700">Eingeschränkte Nutzung</label>
                                                        <p class="text-gray-500">Der Fahrer darf das Fahrzeug nur für bestimmte Zwecke nutzen.</p>
                                                    </div>
                                                </div>

                                                <div class="flex items-start">
                                                    <div class="flex items-center h-5">
                                                        <input id="business-only" name="business-only" type="checkbox" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded">
                                                    </div>
                                                    <div class="ml-3 text-sm">
                                                        <label for="business-only" class="font-medium text-gray-700">Nur geschäftliche Nutzung</label>
                                                        <p class="text-gray-500">Das Fahrzeug darf nur für geschäftliche Zwecke verwendet werden.</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>

                                    <div class="mt-6">
                                        <label for="assignment-notes" class="block text-sm font-medium text-gray-700">Anmerkungen zur Zuweisung</label>
                                        <div class="mt-1">
                                            <textarea id="assignment-notes" name="assignment-notes" rows="3" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border border-gray-300 rounded-md"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="submit" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm">
                        Speichern
                    </button>
                    <button type="button" id="close-modal-btn" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        Abbrechen
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // Funktion zum Speichern eines Fahrzeugs (Erstellen oder Aktualisieren)
    function saveVehicle(vehicleData, isEdit = false) {
        console.log('Zu speichernde Fahrzeugdaten:', vehicleData); // Debug-Ausgabe

        // API-Pfad und Methode basierend auf Bearbeitung oder Neuanlage
        const url = isEdit ? `/api/vehicles/${vehicleData.id}` : '/api/vehicles';
        const method = isEdit ? 'PUT' : 'POST';

        // Stelle sicher, dass der Kilometerstand als Zahl übermittelt wird
        const mileage = parseInt(vehicleData.mileage || 0);

        // Erstelle das Anfrageobjekt mit allen Feldern
        const requestData = {
            licensePlate: vehicleData.license || vehicleData.licensePlate || '',
            brand: vehicleData.brand || '',
            model: vehicleData.model || '',
            year: parseInt(vehicleData.year || 0),
            color: vehicleData.color || '',
            vin: vehicleData.vin || '',
            fuelType: vehicleData['fuel-type'] || vehicleData.fuelType || '',
            mileage: parseInt(vehicleData.mileage || vehicleData.mileage || 0),
            status: vehicleData.status || 'available',
            vehicleId: vehicleData.vehicleId || vehicleData.vehicle_id || '',
            // Datumsfelder
            registrationDate: vehicleData['registration-date'] || null,
            registrationExpiry: vehicleData['registration-expiry'] || null,
            insuranceCompany: vehicleData['insurance-company'] || vehicleData.insuranceCompany || '',
            insuranceNumber: vehicleData['insurance-policy'] || vehicleData.insuranceNumber || '',
            insuranceType: vehicleData['insurance-type'] || vehicleData.insuranceType || '',
            insuranceExpiry: vehicleData['insurance-expiry'] || null,
            nextInspectionDate: vehicleData['next-inspection'] || null,

            // Fahrerzuordnung
            currentDriverId: vehicleData['assigned-driver'] || null
        };

        if (isEdit && (!requestData.vehicleId || requestData.vehicleId.trim() === '')) {
            delete requestData.vehicleId;
        }

        console.log('Anfrage an API:', JSON.stringify(requestData, null, 2)); // Detailliertes Logging

        // API-Anfrage senden
        return fetch(url, {
            method: method,
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(requestData)
        })
            .then(response => {
                console.log('API Response Status:', response.status);
                return response.text().then(text => {
                    try {
                        // Versuchen, die Antwort als JSON zu parsen
                        const jsonResponse = JSON.parse(text);
                        console.log('API Response Body:', jsonResponse);

                        if (!response.ok) {
                            throw new Error('Fehler beim Speichern des Fahrzeugs: ' + text);
                        }

                        return jsonResponse;
                    } catch (e) {
                        console.log('API Raw Response:', text);
                        if (!response.ok) {
                            throw new Error('Fehler beim Speichern des Fahrzeugs: ' + text);
                        }
                        return {};
                    }
                });
            });
    }

    // Funktion zum Löschen eines Fahrzeugs
    function deleteVehicle(vehicleId) {
        return fetch(`/api/vehicles/${vehicleId}`, {
            method: 'DELETE'
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Fehler beim Löschen des Fahrzeugs');
                }
                return response.json();
            });
    }

    // Tab 3: Fahrerzuordnung - Fahrer laden
    // Funktion zum Laden der Fahrer mit einer verbesserten Methode zum Setzen des ausgewählten Fahrers
    function loadDriversForVehicleAssignment(currentDriverId = null) {
        console.log('Lade Fahrer für Fahrzeugzuordnung, aktueller Fahrer ID:', currentDriverId);

        return fetch('/api/drivers')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Fehler beim Laden der Fahrer');
                }
                return response.json();
            })
            .then(data => {
                const drivers = data.drivers || [];
                console.log('Geladene Fahrer für Zuweisung:', drivers);

                const assignedDriverSelect = document.getElementById('assigned-driver');
                if (!assignedDriverSelect) {
                    console.error('Select-Element für Fahrerzuweisung nicht gefunden');
                    return;
                }

                // Bestehende Optionen löschen
                assignedDriverSelect.innerHTML = '';

                // Erste Option (keine Auswahl) hinzufügen
                const noDriverOption = document.createElement('option');
                noDriverOption.value = '';
                noDriverOption.textContent = 'Keinen Fahrer zuweisen';
                assignedDriverSelect.appendChild(noDriverOption);

                // Alle Fahrer hinzufügen
                drivers.forEach(driver => {
                    const option = document.createElement('option');
                    option.value = driver.id;
                    option.textContent = `${driver.firstName} ${driver.lastName}`;
                    assignedDriverSelect.appendChild(option);
                });

                // Nach dem Hinzufügen aller Optionen den Fahrer auswählen
                if (currentDriverId) {
                    // Direkte Ausgabe aller verfügbaren Optionen zur Fehlersuche
                    console.log('Alle verfügbaren Optionen im Dropdown:');
                    Array.from(assignedDriverSelect.options).forEach((option, index) => {
                        console.log(`Option ${index}: value='${option.value}', text='${option.textContent}'`);
                    });

                    // Normalisieren des currentDriverId-Werts für den Vergleich
                    const normalizedCurrentDriverId = currentDriverId.toString().trim();
                    console.log('Normalisierte CurrentDriverId:', normalizedCurrentDriverId);

                    // Explizit versuchen, den Wert zu setzen
                    assignedDriverSelect.value = normalizedCurrentDriverId;

                    // Überprüfen, ob die Auswahl geklappt hat
                    if (assignedDriverSelect.value !== normalizedCurrentDriverId) {
                        console.warn('Automatische Auswahl fehlgeschlagen, versuche manuelle Suche.');

                        // Manuell nach der passenden Option suchen und auswählen
                        for (let i = 0; i < assignedDriverSelect.options.length; i++) {
                            const option = assignedDriverSelect.options[i];
                            const optionValue = option.value.toString().trim();

                            console.log(`Vergleiche Option ${i}: '${optionValue}' mit '${normalizedCurrentDriverId}'`);

                            if (optionValue === normalizedCurrentDriverId) {
                                console.log(`Match gefunden bei Option ${i}, setze selectedIndex`);
                                assignedDriverSelect.selectedIndex = i;
                                break;
                            }
                        }
                    }

                    // Überprüfen des Ergebnisses
                    console.log('Finale Auswahl im Dropdown:', assignedDriverSelect.value);
                }

                return drivers;
            })
            .catch(error => {
                console.error('Fehler beim Laden der Fahrer:', error);
            });
    }

    // Funktion zum Laden aller Fahrzeuge für die Übersicht
    function loadVehicles() {
        return fetch('/api/vehicles')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Fehler beim Laden der Fahrzeuge');
                }
                return response.json();
            })
            .then(data => {
                // Sicherstellen, dass das vehicles-Array existiert
                const vehicles = data.vehicles || [];
                console.log('Geladene Fahrzeugdaten:', vehicles); // Debug-Ausgabe

                // Wenn keine currentDriverId vorhanden ist, direkt rendern
                if (!vehicles.some(v => v.currentDriverId)) {
                    renderVehicles(vehicles);
                    return;
                }

                // Alle Fahrer laden für die Lookup-Tabelle
                return fetch('/api/drivers')
                    .then(response => {
                        if (!response.ok) {
                            // Wenn Fahrer nicht geladen werden können, trotzdem Fahrzeuge anzeigen
                            renderVehicles(vehicles);
                            return;
                        }
                        return response.json();
                    })
                    .then(driversData => {
                        if (!driversData || !driversData.drivers) {
                            renderVehicles(vehicles);
                            return;
                        }

                        // Fahrer-Lookup-Tabelle erstellen
                        const driversMap = {};
                        driversData.drivers.forEach(driver => {
                            driversMap[driver.id] = driver;
                        });

                        console.log('Fahrer-Lookup-Tabelle:', driversMap);

                        // Fahrzeuge mit Fahrernamen anreichern
                        const enrichedVehicles = vehicles.map(vehicle => {
                            if (vehicle.currentDriverId && driversMap[vehicle.currentDriverId]) {
                                const driver = driversMap[vehicle.currentDriverId];
                                vehicle.driverName = `${driver.firstName} ${driver.lastName}`;
                            }
                            return vehicle;
                        });

                        renderVehicles(enrichedVehicles);
                    })
                    .catch(error => {
                        console.error('Fehler beim Laden der Fahrer:', error);
                        renderVehicles(vehicles);
                    });
            })
            .catch(error => {
                console.error('Fehler:', error);
                // Fehlermeldung anzeigen
                const container = document.querySelector('.grid');
                if (container) {
                    container.innerHTML = `
                    <div class="col-span-full p-4 bg-red-50 text-red-700 rounded-lg">
                        <p>Fehler beim Laden der Fahrzeuge: ${error.message}</p>
                    </div>
                `;
                }
            });
    }

    // Funktion zum Rendern der Fahrzeuge in der Übersicht
    function renderVehicles(vehicles) {
        // Sicherstellung, dass vehicles ein Array ist
        if (!vehicles || !Array.isArray(vehicles)) {
            vehicles = [];
        }

        // Finden des Containers für die Fahrzeugkarten
        const container = document.querySelector('.grid.grid-cols-1.gap-6');
        if (!container) {
            console.error('Container für Fahrzeuge nicht gefunden');
            return;
        }

        container.innerHTML = '';

        if (vehicles.length === 0) {
            container.innerHTML = `
            <div class="col-span-full p-4 bg-gray-50 text-gray-500 rounded-lg text-center">
                <p>Keine Fahrzeuge gefunden.</p>
            </div>
        `;
            return;
        }

        vehicles.forEach(vehicle => {
            // Status-Klassen und Text ermitteln
            let statusClass, statusText;

            switch (vehicle.status) {
                case 'available':
                    statusClass = 'bg-green-100 text-green-800';
                    statusText = 'Verfügbar';
                    break;
                case 'inuse':
                    statusClass = 'bg-red-100 text-red-800';
                    statusText = 'In Benutzung';
                    break;
                case 'maintenance':
                    statusClass = 'bg-yellow-100 text-yellow-800';
                    statusText = 'In Wartung';
                    break;
                default:
                    statusClass = 'bg-gray-100 text-gray-800';
                    statusText = vehicle.status || 'Unbekannt';
            }

            // Fahrzeugkarte erstellen
            const card = document.createElement('div');
            card.className = 'bg-white overflow-hidden shadow rounded-lg';
            card.innerHTML = `
            <div class="p-5">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg leading-6 font-medium text-gray-900">${vehicle.brand || ''} ${vehicle.model || ''}</h3>
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">
                        ${statusText}
                    </span>
                </div>
                <div class="mt-3 grid grid-cols-3 gap-3 text-sm text-gray-500">
                    <div>
                        <span class="block font-medium text-gray-700">Kennzeichen</span>
                        <span>${vehicle.licensePlate || ''}</span>
                    </div>
                    <div>
                        <span class="block font-medium text-gray-700">Baujahr</span>
                        <span>${vehicle.year || ''}</span>
                    </div>
                    <div>
                        <span class="block font-medium text-gray-700">Fahrer</span>
                        <span>${vehicle.driverName || vehicle.currentDriverId ? vehicle.driverName : 'Nicht zugewiesen'}</span>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-200 px-5 py-3 bg-gray-50 flex justify-end space-x-3">
                <button type="button" class="edit-vehicle-btn inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" data-id="${vehicle.id}">
                    <svg class="-ml-0.5 mr-1 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                    </svg>
                    Bearbeiten
                </button>
                <a href="/vehicle-details/${vehicle.id}" class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded text-indigo-700 bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    <svg class="-ml-0.5 mr-1 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                    </svg>
                    Details
                </a>
            </div>
        `;

            container.appendChild(card);
        });

        // Event-Listener für die Bearbeiten-Buttons hinzufügen
        document.querySelectorAll('.edit-vehicle-btn').forEach(button => {
            button.addEventListener('click', function() {
                const vehicleId = this.dataset.id;
                openVehicleModal(true, vehicleId);
            });
        });
    }

    // Funktion zum Öffnen des Fahrzeug-Modals mit vorausgefüllten Daten bei Bearbeitung
    function openVehicleModal(isEdit = false, vehicleId = null) {
        const modal = document.getElementById('vehicle-modal');
        const modalTitle = document.getElementById('modal-title');
        const vehicleForm = document.getElementById('vehicle-form');

        if (!modal || !modalTitle || !vehicleForm) {
            console.error('Modal-Elemente nicht gefunden');
            return;
        }

        modal.classList.remove('hidden');

        // Standardmäßig zum ersten Tab wechseln
        document.querySelectorAll('.tab-btn').forEach(button => {
            if (button.dataset.tab === 'vehicle-data') {
                button.click();
            }
        });

        if (isEdit && vehicleId) {
            modalTitle.textContent = 'Fahrzeug bearbeiten';

            // Fahrzeugdaten von der API laden
            fetch(`/api/vehicles/${vehicleId}`)
                .then(response => response.json())
                .then(data => {
                    const vehicle = data.vehicle;
                    console.log('Geladene Fahrzeugdaten für Bearbeitung:', vehicle); // Debug-Ausgabe

                    if (!vehicle) {
                        throw new Error('Fahrzeugdaten nicht gefunden');
                    }

                    // Formularfelder befüllen - Tab 1: Fahrzeugdaten
                    if (document.getElementById('brand')) {
                        document.getElementById('brand').value = vehicle.brand || '';
                    }
                    if (document.getElementById('model')) {
                        document.getElementById('model').value = vehicle.model || '';
                    }
                    if (document.getElementById('year')) {
                        document.getElementById('year').value = vehicle.year || '';
                    }
                    if (document.getElementById('license')) {
                        document.getElementById('license').value = vehicle.licensePlate || '';
                    }
                    if (document.getElementById('color')) {
                        document.getElementById('color').value = vehicle.color || '';
                    }
                    if (document.getElementById('vin')) {
                        document.getElementById('vin').value = vehicle.vin || '';
                    }
                    if (document.getElementById('fuel-type')) {
                        document.getElementById('fuel-type').value = vehicle.fuelType || '';
                    }
                    if (document.getElementById('mileage')) {
                        document.getElementById('mileage').value = vehicle.mileage || 0;
                    }


                    // Tab 2: Zulassung & Versicherung
                    // Zulassungsdatum
                    if (document.getElementById('registration-date')) {
                        document.getElementById('registration-date').value = formatDateForInput(vehicle.registrationDate);
                    }

                    // Ablaufdatum der Zulassung
                    if (document.getElementById('registration-expiry')) {
                        document.getElementById('registration-expiry').value = formatDateForInput(vehicle.registrationExpiry);
                    }

                    // Versicherungsgesellschaft
                    if (document.getElementById('insurance-company')) {
                        document.getElementById('insurance-company').value = vehicle.insuranceCompany || '';
                    }

                    // Versicherungspolice-Nr.
                    if (document.getElementById('insurance-policy')) {
                        document.getElementById('insurance-policy').value = vehicle.insuranceNumber || '';
                    }

                    // Versicherungstyp
                    if (document.getElementById('insurance-type')) {
                        document.getElementById('insurance-type').value = vehicle.insuranceType || '';
                    }

                    // Ablaufdatum der Versicherung
                    if (document.getElementById('insurance-expiry')) {
                        document.getElementById('insurance-expiry').value = formatDateForInput(vehicle.insuranceExpiry);
                    }

                    // Nächste HU/AU
                    if (document.getElementById('next-inspection')) {
                        document.getElementById('next-inspection').value = formatDateForInput(vehicle.nextInspectionDate);
                    }

                    // Status setzen
                    if (document.getElementById('status')) {
                        document.getElementById('status').value = vehicle.status || 'available';
                    }

                    // Tab 3: Fahrerzuordnung - In openVehicleModal-Funktion
                    const currentDriverId = vehicle.currentDriverId ? vehicle.currentDriverId.toString() : '';
                    console.log('Zugewiesener Fahrer ID:', currentDriverId);

                    // Fahrer laden, falls es den Tab "driver-assignment" gibt
                    const driverTab = document.getElementById('driver-assignment');
                    if (driverTab) {
                        // Tab öffnen, um sicherzustellen, dass die Elemente verfügbar sind
                        document.querySelectorAll('.tab-btn').forEach(button => {
                            if (button.dataset.tab === 'driver-assignment') {
                                button.click();
                            }
                        });

                        // Fahrer laden und zuweisen mit mehreren Versuchen
                        loadDriversForVehicleAssignment(currentDriverId)
                            .then(() => {
                                // Nochmals explizit versuchen, den Wert zu setzen nach einer kurzen Verzögerung
                                setTimeout(() => {
                                    const assignedDriverSelect = document.getElementById('assigned-driver');
                                    if (assignedDriverSelect && currentDriverId) {
                                        console.log('Zusätzlicher Versuch, den Fahrer zu setzen:', currentDriverId);

                                        // Direkter Versuch
                                        assignedDriverSelect.value = currentDriverId;

                                        // Falls das nicht klappt, über Event simulieren
                                        if (assignedDriverSelect.value !== currentDriverId) {
                                            // Erstelle und löse ein Change-Event aus
                                            const event = new Event('change', { bubbles: true });
                                            assignedDriverSelect.dispatchEvent(event);

                                            // Überprüfe das Ergebnis
                                            console.log('Nach Event-Auslösung:', assignedDriverSelect.value);
                                        }
                                    }
                                }, 200);

                                // Zurück zum ersten Tab wechseln
                                document.querySelectorAll('.tab-btn').forEach(button => {
                                    if (button.dataset.tab === 'vehicle-data') {
                                        button.click();
                                    }
                                });
                            });
                    }

                    // ID zum Formular hinzufügen
                    let idInput = vehicleForm.querySelector('input[name="id"]');
                    if (!idInput) {
                        idInput = document.createElement('input');
                        idInput.type = 'hidden';
                        idInput.name = 'id';
                        vehicleForm.appendChild(idInput);
                    }
                    idInput.value = vehicleId;
                })
                .catch(error => {
                    console.error('Fehler beim Laden des Fahrzeugs:', error);
                    closeVehicleModal();
                    alert('Fehler beim Laden des Fahrzeugs: ' + error.message);
                });
        } else {
            modalTitle.textContent = 'Fahrzeug hinzufügen';
            vehicleForm.reset();

            // Fahrer für neues Fahrzeug laden
            const driverTab = document.getElementById('driver-assignment');
            if (driverTab) {
                // Tab öffnen, um sicherzustellen, dass die Elemente verfügbar sind
                document.querySelectorAll('.tab-btn').forEach(button => {
                    if (button.dataset.tab === 'driver-assignment') {
                        button.click();
                    }
                });

                // Fahrer laden
                setTimeout(() => {
                    loadDriversForVehicleAssignment();

                    // Zurück zum ersten Tab wechseln
                    document.querySelectorAll('.tab-btn').forEach(button => {
                        if (button.dataset.tab === 'vehicle-data') {
                            button.click();
                        }
                    });
                }, 100);
            }

            // Entferne versteckte ID-Felder, falls vorhanden
            const existingIdInput = vehicleForm.querySelector('input[name="id"]');
            if (existingIdInput) {
                existingIdInput.remove();
            }
        }
    }

    // Tab 3: Fahrerzuordnung - Fahrer laden
    function loadDriversForVehicleAssignment(currentDriverId = null) {
        return fetch('/api/drivers')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Fehler beim Laden der Fahrer');
                }
                return response.json();
            })
            .then(data => {
                const drivers = data.drivers || [];
                console.log('Geladene Fahrer:', drivers);

                const assignedDriverSelect = document.getElementById('assigned-driver');
                if (!assignedDriverSelect) return;

                // Bestehende Optionen löschen, aber die erste Option (keine Zuweisung) beibehalten
                const firstOption = assignedDriverSelect.querySelector('option:first-child');
                assignedDriverSelect.innerHTML = '';

                // Erste Option wieder hinzufügen
                if (firstOption) {
                    assignedDriverSelect.appendChild(firstOption);
                } else {
                    const noDriverOption = document.createElement('option');
                    noDriverOption.value = '';
                    noDriverOption.textContent = 'Keinen Fahrer zuweisen';
                    assignedDriverSelect.appendChild(noDriverOption);
                }

                // Alle Fahrer hinzufügen
                drivers.forEach(driver => {
                    const option = document.createElement('option');
                    option.value = driver.id;
                    option.textContent = `${driver.firstName} ${driver.lastName}`;

                    // Wenn dieser Fahrer der aktuell zugewiesene ist, auswählen
                    if (currentDriverId && driver.id === currentDriverId) {
                        option.selected = true;
                    }

                    assignedDriverSelect.appendChild(option);
                });
            })
            .catch(error => {
                console.error('Fehler beim Laden der Fahrer:', error);
            });
    }

    // Funktion zum Schließen des Fahrzeug-Modals
    function closeVehicleModal() {
        const modal = document.getElementById('vehicle-modal');
        if (modal) {
            modal.classList.add('hidden');
        }
    }

    function formatDateForInput(dateString) {
        if (!dateString) return '';

        try {
            // Versuchen Sie, das Datum zu parsen (sowohl als ISO-String als auch als Timestamp)
            const date = new Date(dateString);

            // Überprüfen, ob das Datum gültig ist
            if (isNaN(date.getTime())) {
                console.warn('Ungültiges Datum:', dateString);
                return '';
            }

            // Formatieren Sie das Datum als YYYY-MM-DD (für HTML input type="date")
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');

            return `${year}-${month}-${day}`;
        } catch (error) {
            console.error('Fehler beim Formatieren des Datums:', error);
            return '';
        }
    }

    // Event-Listener hinzufügen, wenn das DOM geladen ist
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM geladen, initialisiere Fahrzeugfunktionen...');

        // Fahrzeuge laden
        loadVehicles();

        // Event-Listener für "Fahrzeug hinzufügen"-Button
        const addVehicleBtn = document.getElementById('add-vehicle-btn');
        if (addVehicleBtn) {
            addVehicleBtn.addEventListener('click', () => openVehicleModal(false));
        } else {
            console.warn('Button "Fahrzeug hinzufügen" nicht gefunden');
        }

        // Event-Listener für "Schließen"-Button im Modal
        const closeModalBtn = document.getElementById('close-modal-btn');
        if (closeModalBtn) {
            closeModalBtn.addEventListener('click', closeVehicleModal);
        } else {
            console.warn('Button "Schließen" nicht gefunden');
        }

        // Event-Listener für Klick außerhalb des Modals
        const vehicleModal = document.getElementById('vehicle-modal');
        if (vehicleModal) {
            vehicleModal.addEventListener('click', function(event) {
                if (event.target === vehicleModal) {
                    closeVehicleModal();
                }
            });
        } else {
            console.warn('Fahrzeug-Modal nicht gefunden');
        }

        // Event-Listener für Tab-Navigation im Modal
        const tabButtons = document.querySelectorAll('.tab-btn');
        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                const tabId = this.dataset.tab;

                // Alle Tab-Inhalte ausblenden
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });

                // Alle Tab-Buttons zurücksetzen
                tabButtons.forEach(btn => {
                    btn.classList.remove('border-indigo-500', 'text-indigo-600');
                    btn.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                });

                // Ausgewählten Tab anzeigen
                const selectedTab = document.getElementById(tabId);
                if (selectedTab) {
                    selectedTab.classList.remove('hidden');
                }

                // Ausgewählten Button hervorheben
                this.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                this.classList.add('border-indigo-500', 'text-indigo-600');
            });
        });

        // Event-Listener für das Fahrzeug-Formular
        const vehicleForm = document.getElementById('vehicle-form');
        if (vehicleForm) {
            vehicleForm.addEventListener('submit', function(event) {
                event.preventDefault();

                // Formulardaten sammeln
                const formData = new FormData(vehicleForm);
                const vehicleData = {};

                for (let [key, value] of formData.entries()) {
                    vehicleData[key] = value;
                }

                // Prüfen, ob es eine Bearbeitung ist (ID vorhanden)
                const isEdit = !!vehicleData.id;

                // Fahrzeug speichern
                saveVehicle(vehicleData, isEdit)
                    .then(response => {
                        console.log('Fahrzeug erfolgreich gespeichert:', response);
                        closeVehicleModal();
                        loadVehicles(); // Liste aktualisieren
                        alert('Fahrzeug erfolgreich gespeichert!');
                    })
                    .catch(error => {
                        console.error('Fehler:', error);
                        alert(`Fehler beim Speichern des Fahrzeugs: ${error.message}`);
                    });
            });
        } else {
            console.warn('Fahrzeug-Formular nicht gefunden');
        }

        // Event-Listener für Filter und Suche
        const searchInput = document.getElementById('search');
        if (searchInput) {
            searchInput.addEventListener('input', function() {
                const searchText = this.value.toLowerCase();
                const vehicleCards = document.querySelectorAll('.grid > div');

                vehicleCards.forEach(card => {
                    const cardText = card.textContent.toLowerCase();
                    card.style.display = cardText.includes(searchText) ? '' : 'none';
                });
            });
        }

        const statusFilter = document.getElementById('status-filter');
        if (statusFilter) {
            statusFilter.addEventListener('change', function() {
                const selectedStatus = this.value;
                const vehicleCards = document.querySelectorAll('.grid > div');

                vehicleCards.forEach(card => {
                    if (selectedStatus === 'all') {
                        card.style.display = '';
                        return;
                    }

                    const statusElement = card.querySelector('.rounded-full');
                    if (!statusElement) return;

                    const statusText = statusElement.textContent.trim().toLowerCase();

                    let matchesFilter = false;

                    if (selectedStatus === 'available' && statusText === 'verfügbar') {
                        matchesFilter = true;
                    } else if (selectedStatus === 'inuse' && statusText === 'in benutzung') {
                        matchesFilter = true;
                    } else if (selectedStatus === 'maintenance' && statusText === 'in wartung') {
                        matchesFilter = true;
                    }

                    card.style.display = matchesFilter ? '' : 'none';
                });
            });
        }

        console.log('Initialisierung abgeschlossen.');
    });
</script>
</body>
</html>