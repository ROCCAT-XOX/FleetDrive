{{ template "head" .}}
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen flex flex-col">
<!-- Navigation -->
{{ template "navigation" .}}

<!-- Main Content -->
<main class="container mx-auto px-4 py-6 flex-grow">
    <!-- Dashboard Header mit Statistiken -->
    <div class="grid grid-cols-1 gap-6 mb-6 lg:grid-cols-4">
        <div class="flex items-center p-4 bg-white dark:bg-gray-800 rounded-lg shadow-md border-l-4 border-blue-500">
            <div class="flex-shrink-0 mr-4 text-blue-500">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v12a2 2 0 01-2 2z" />
                    <path d="M12 14v3M8 14v3M16 14v3M4 8h16"/>
                </svg>
            </div>
            <div>
                <span class="block text-2xl font-bold dark:text-white">8</span>
                <span class="block text-gray-500 dark:text-gray-300">Gesamtfahrzeuge</span>
            </div>
        </div>
        <div class="flex items-center p-4 bg-white dark:bg-gray-800 rounded-lg shadow-md border-l-4 border-green-500">
            <div class="flex-shrink-0 mr-4 text-green-500">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 17H5a2 2 0 0 0-2 2 2 2 0 0 0 2 2h2a2 2 0 0 0 2-2zm0 0V9a2 2 0 0 1 2-2h2m4 10h4a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2zm0 0V9a2 2 0 0 0-2-2h-2m5 0a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm-9 0a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/>
                </svg>
            </div>
            <div>
                <span class="block text-2xl font-bold dark:text-white">5</span>
                <span class="block text-gray-500 dark:text-gray-300">Aktive Fahrer</span>
            </div>
        </div>
        <div class="flex items-center p-4 bg-white dark:bg-gray-800 rounded-lg shadow-md border-l-4 border-yellow-500">
            <div class="flex-shrink-0 mr-4 text-yellow-500">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10" />
                    <path d="M12 6v6l4 2" />
                </svg>
            </div>
            <div>
                <span class="block text-2xl font-bold dark:text-white">3</span>
                <span class="block text-gray-500 dark:text-gray-300">Ausstehende Wartungen</span>
            </div>
        </div>
        <div class="flex items-center p-4 bg-white dark:bg-gray-800 rounded-lg shadow-md border-l-4 border-red-500">
            <div class="flex-shrink-0 mr-4 text-red-500">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <div>
                <span class="block text-2xl font-bold dark:text-white">2</span>
                <span class="block text-gray-500 dark:text-gray-300">Offene Probleme</span>
            </div>
        </div>
    </div>

    <!-- Hauptbereich mit Karten -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Linke Spalte -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Flottenübersicht-Karte -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden">
                <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Flottenübersicht</h3>
                    <div class="flex space-x-2">
                        <div class="relative">
                            <select id="fleet-view-filter" class="text-sm border-gray-300 rounded-md pr-8 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="all">Alle</option>
                                <option value="available">Verfügbar</option>
                                <option value="inuse">In Benutzung</option>
                                <option value="maintenance">In Wartung</option>
                            </select>
                        </div>
                        <a href="/vehicles" class="text-sm text-blue-600 dark:text-blue-400 hover:underline">Alle anzeigen</a>
                    </div>
                </div>
                <div class="p-4">
                    <!-- Vehicle Status Section -->
                    <div id="vehicles-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-4">
                        <!-- Vehicles will be inserted here by JavaScript -->
                        <div class="bg-gray-100 dark:bg-gray-700 rounded-lg animate-pulse h-24"></div>
                        <div class="bg-gray-100 dark:bg-gray-700 rounded-lg animate-pulse h-24"></div>
                        <div class="bg-gray-100 dark:bg-gray-700 rounded-lg animate-pulse h-24"></div>
                        <div class="bg-gray-100 dark:bg-gray-700 rounded-lg animate-pulse h-24"></div>
                    </div>
                </div>
            </div>

            <!-- Aktivitätsdiagramm-Karte -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden">
                <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Flottenaktivität</h3>
                </div>
                <div class="p-4">
                    <div class="relative h-64">
                        <canvas id="fleetActivityChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rechte Spalte -->
        <div class="space-y-6">
            <!-- Fahrerstatus-Karte -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden">
                <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Fahrerstatus</h3>
                    <a href="/drivers" class="text-sm text-blue-600 dark:text-blue-400 hover:underline">Alle anzeigen</a>
                </div>
                <div class="p-4">
                    <!-- Driver Status -->
                    <div id="drivers-container" class="space-y-3">
                        <!-- Drivers will be inserted here by JavaScript -->
                        <div class="bg-gray-100 dark:bg-gray-700 rounded-lg animate-pulse h-16"></div>
                        <div class="bg-gray-100 dark:bg-gray-700 rounded-lg animate-pulse h-16"></div>
                        <div class="bg-gray-100 dark:bg-gray-700 rounded-lg animate-pulse h-16"></div>
                    </div>
                </div>
            </div>

            <!-- Anstehende Wartungen-Karte -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden">
                <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Anstehende Wartungen</h3>
                </div>
                <div class="p-4">
                    <ul class="divide-y divide-gray-200 dark:divide-gray-700">
                        <li class="py-3">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-900 dark:text-white">BMW 530e</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">HU/AU fällig in 2 Tagen</p>
                                </div>
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300">
                                    18.04.2025
                                </span>
                            </div>
                        </li>
                        <li class="py-3">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-900 dark:text-white">VW Passat</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Ölwechsel fällig in 7 Tagen</p>
                                </div>
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300">
                                    22.04.2025
                                </span>
                            </div>
                        </li>
                        <li class="py-3">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-900 dark:text-white">Audi e-tron</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Reifenwechsel fällig in 14 Tagen</p>
                                </div>
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300">
                                    30.04.2025
                                </span>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Letzte Aktivitäten-Karte -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden">
                <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Letzte Aktivitäten</h3>
                </div>
                <div class="p-4">
                    <div class="flow-root">
                        <ul class="-mb-8">
                            <li>
                                <div class="relative pb-8">
                                    <span class="absolute top-4 left-4 -ml-px h-full w-0.5 bg-gray-200 dark:bg-gray-700" aria-hidden="true"></span>
                                    <div class="relative flex space-x-3">
                                        <div>
                                            <span class="h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center ring-8 ring-white dark:ring-gray-800">
                                                <svg class="h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.75-13a.75.75 0 00-1.5 0v5.5a.75.75 0 001.5 0V5z" clip-rule="evenodd" />
                                                </svg>
                                            </span>
                                        </div>
                                        <div class="min-w-0 flex-1">
                                            <div>
                                                <div class="text-sm text-gray-500 dark:text-gray-400">
                                                    <a href="#" class="font-medium text-gray-900 dark:text-white">Max Mustermann</a> hat die Nutzung von <a href="#" class="font-medium text-gray-900 dark:text-white">BMW 530e</a> gestartet
                                                </div>
                                                <p class="mt-0.5 text-sm text-gray-500 dark:text-gray-400">Heute 08:30 Uhr</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <div class="relative pb-8">
                                    <span class="absolute top-4 left-4 -ml-px h-full w-0.5 bg-gray-200 dark:bg-gray-700" aria-hidden="true"></span>
                                    <div class="relative flex space-x-3">
                                        <div>
                                            <span class="h-8 w-8 rounded-full bg-green-500 flex items-center justify-center ring-8 ring-white dark:ring-gray-800">
                                                <svg class="h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                                                </svg>
                                            </span>
                                        </div>
                                        <div class="min-w-0 flex-1">
                                            <div>
                                                <div class="text-sm text-gray-500 dark:text-gray-400">
                                                    <a href="#" class="font-medium text-gray-900 dark:text-white">Erika Musterfrau</a> hat die Wartung von <a href="#" class="font-medium text-gray-900 dark:text-white">Audi e-tron</a> abgeschlossen
                                                </div>
                                                <p class="mt-0.5 text-sm text-gray-500 dark:text-gray-400">Gestern 17:45 Uhr</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <div class="relative pb-8">
                                    <div class="relative flex space-x-3">
                                        <div>
                                            <span class="h-8 w-8 rounded-full bg-red-500 flex items-center justify-center ring-8 ring-white dark:ring-gray-800">
                                                <svg class="h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                                                </svg>
                                            </span>
                                        </div>
                                        <div class="min-w-0 flex-1">
                                            <div>
                                                <div class="text-sm text-gray-500 dark:text-gray-400">
                                                    <a href="#" class="font-medium text-gray-900 dark:text-white">John Doe</a> hat ein Problem mit <a href="#" class="font-medium text-gray-900 dark:text-white">VW Passat</a> gemeldet
                                                </div>
                                                <p class="mt-0.5 text-sm text-gray-500 dark:text-gray-400">14.04.2025 10:23 Uhr</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Footer -->
<footer class="bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 py-4 mt-6">
    <div class="container mx-auto px-4 text-center text-gray-500 dark:text-gray-400 text-sm">
        &copy; {{.year}} FleetDrive. Alle Rechte vorbehalten.
    </div>
</footer>

<!-- Load Chart.js for charts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
<!-- Theme Toggle Script (Dark/Light Mode) -->
<script>
    // Check for saved theme preference or use system preference
    if (localStorage.getItem('color-theme') === 'dark' ||
        (!localStorage.getItem('color-theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
    } else {
        document.documentElement.classList.remove('dark');
    }
</script>

<script>
    // Fahrzeugdaten laden
    fetch('/api/vehicles')
        .then(response => response.json())
        .then(data => {
            const vehiclesContainer = document.getElementById('vehicles-container');
            vehiclesContainer.innerHTML = '';  // Clear loading placeholders

            data.vehicles.forEach(vehicle => {
                const statusColors = {
                    'Available': {
                        bg: 'bg-green-100',
                        text: 'text-green-800',
                        darkBg: 'dark:bg-green-900/30',
                        darkText: 'dark:text-green-400',
                        icon: '<span class="absolute -left-1 -top-1 h-3 w-3 rounded-full bg-green-500 ring-2 ring-white dark:ring-gray-800"></span>',
                        label: 'Verfügbar'
                    },
                    'In Use': {
                        bg: 'bg-red-100',
                        text: 'text-red-800',
                        darkBg: 'dark:bg-red-900/30',
                        darkText: 'dark:text-red-400',
                        icon: '<span class="absolute -left-1 -top-1 h-3 w-3 rounded-full bg-red-500 ring-2 ring-white dark:ring-gray-800"></span>',
                        label: 'In Benutzung'
                    }
                };

                const status = vehicle.status in statusColors ? statusColors[vehicle.status] :
                    {bg: 'bg-gray-100', text: 'text-gray-800', darkBg: 'dark:bg-gray-700', darkText: 'dark:text-gray-300', icon: '', label: vehicle.status};

                const vehicleCard = document.createElement('div');
                vehicleCard.className = 'bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4 shadow-sm hover:shadow-md transition-all relative';
                vehicleCard.innerHTML = `
                    ${status.icon}
                    <div class="flex justify-between items-start">
                        <div>
                            <h4 class="text-md font-semibold text-gray-800 dark:text-white">${vehicle.name}</h4>
                            <p class="text-gray-500 dark:text-gray-400 text-xs mt-1">ID: ${vehicle.id}</p>
                        </div>
                        <span class="inline-flex px-2 py-0.5 ${status.bg} ${status.text} ${status.darkBg} ${status.darkText} text-xs font-medium rounded-full">
                            ${status.label}
                        </span>
                    </div>
                    <div class="mt-2 pt-2 border-t border-gray-100 dark:border-gray-700">
                        <div class="flex justify-between items-center">
                            <a href="/vehicle-details/${vehicle.id}" class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 text-xs font-medium flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                                    <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                                </svg>
                                Details
                            </a>
                            <button class="text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300 text-xs">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M6 10a2 2 0 11-4 0 2 2 0 014 0zM12 10a2 2 0 11-4 0 2 2 0 014 0zM16 12a2 2 0 100-4 2 2 0 000 4z" />
                                </svg>
                            </button>
                        </div>
                    </div>
                `;
                vehiclesContainer.appendChild(vehicleCard);
            });
        })
        .catch(error => {
            console.error('Error loading vehicles:', error);
            const vehiclesContainer = document.getElementById('vehicles-container');
            vehiclesContainer.innerHTML = `
                <div class="col-span-full p-4 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 rounded-lg border border-red-200 dark:border-red-800">
                    <p>Fehler beim Laden der Fahrzeugdaten. Bitte versuchen Sie es später erneut.</p>
                </div>
            `;
        });

    // Fahrerdaten laden
    fetch('/api/drivers')
        .then(response => response.json())
        .then(data => {
            const driversContainer = document.getElementById('drivers-container');
            driversContainer.innerHTML = '';  // Clear loading placeholders

            data.drivers.forEach(driver => {
                let statusConfig = {
                    bg: 'bg-green-100',
                    text: 'text-green-800',
                    darkBg: 'dark:bg-green-900/30',
                    darkText: 'dark:text-green-400',
                    ringColor: 'bg-green-500',
                    label: 'Verfügbar'
                };

                if (driver.status === 'On duty') {
                    statusConfig = {
                        bg: 'bg-yellow-100',
                        text: 'text-yellow-800',
                        darkBg: 'dark:bg-yellow-900/30',
                        darkText: 'dark:text-yellow-400',
                        ringColor: 'bg-yellow-500',
                        label: 'Im Dienst'
                    };
                } else if (driver.status !== 'Available') {
                    statusConfig = {
                        bg: 'bg-red-100',
                        text: 'text-red-800',
                        darkBg: 'dark:bg-red-900/30',
                        darkText: 'dark:text-red-400',
                        ringColor: 'bg-red-500',
                        label: 'Nicht verfügbar'
                    };
                }

                const driverElement = document.createElement('div');
                driverElement.className = 'flex items-center p-3 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors';
                driverElement.innerHTML = `
                    <div class="flex-shrink-0 mr-3 relative">
                        <img class="h-10 w-10 rounded-full" src="https://images.unsplash.com/photo-${driver.id === '1' ? '1472099645785-5658abf4ff4e' : driver.id === '2' ? '1494790108377-be9c29b29330' : '1506794778202-cad84cf45f1d'}?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80" alt="${driver.name}">
                        <span class="absolute bottom-0 right-0 h-3 w-3 rounded-full ${statusConfig.ringColor} ring-2 ring-white dark:ring-gray-800"></span>
                    </div>
                    <div class="min-w-0 flex-1">
                        <p class="text-sm font-medium text-gray-900 dark:text-white truncate">${driver.name}</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400 truncate">ID: ${driver.id}</p>
                    </div>
                    <div>
                        <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${statusConfig.bg} ${statusConfig.text} ${statusConfig.darkBg} ${statusConfig.darkText}">
                            ${statusConfig.label}
                        </span>
                    </div>
                `;
                driversContainer.appendChild(driverElement);
            });
        })
        .catch(error => {
            console.error('Error loading drivers:', error);
            const driversContainer = document.getElementById('drivers-container');
            driversContainer.innerHTML = `
                <div class="p-4 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 rounded-lg border border-red-200 dark:border-red-800">
                    <p>Fehler beim Laden der Fahrerdaten. Bitte versuchen Sie es später erneut.</p>
                </div>
            `;
        });

    // Aktivitätsdiagramm erstellen
    const createActivityChart = () => {
        const ctx = document.getElementById('fleetActivityChart').getContext('2d');

        // Beispieldaten der letzten 7 Tage
        const labels = [
            '09.04', '10.04', '11.04', '12.04', '13.04', '14.04', '15.04'
        ];

        // Farben für den Chart
        const isDarkMode = document.documentElement.classList.contains('dark');
        const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
        const textColor = isDarkMode ? 'rgba(255, 255, 255, 0.7)' : 'rgba(0, 0, 0, 0.7)';

        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Gefahrene Kilometer',
                        data: [120, 190, 230, 180, 85, 150, 210],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: 'Fahrzeuge im Einsatz',
                        data: [3, 4, 5, 4, 2, 3, 5],
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        fill: true,
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    },
                    legend: {
                        position: 'top',
                        labels: {
                            color: textColor
                        }
                    }
                },
                scales: {
                    x: {
                        grid: {
                            color: gridColor
                        },
                        ticks: {
                            color: textColor
                        }
                    },
                    y: {
                        grid: {
                            color: gridColor
                        },
                        ticks: {
                            color: textColor
                        }
                    }
                }
            }
        });
    };

    // Dark Mode Toggle-Ereignis überwachen, um Chart bei Änderung neu zu rendern
    const darkModeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
    darkModeMediaQuery.addEventListener('change', () => {
        // Bestehenden Chart zerstören und neu erstellen
        if (window.fleetActivityChart) {
            window.fleetActivityChart.destroy();
        }
        createActivityChart();
    });

    // Beim Laden der Seite den Chart erstellen
    document.addEventListener('DOMContentLoaded', () => {
        createActivityChart();

        // Filter für Flottenübersicht
        const fleetViewFilter = document.getElementById('fleet-view-filter');
        if (fleetViewFilter) {
            fleetViewFilter.addEventListener('change', function() {
                const selectedStatus = this.value;
                const vehicleCards = document.querySelectorAll('#vehicles-container > div');

                vehicleCards.forEach(card => {
                    if (selectedStatus === 'all') {
                        card.style.display = '';
                        return;
                    }

                    const statusText = card.querySelector('.rounded-full')?.textContent.trim().toLowerCase();
                    if (!statusText) return;

                    let matchesFilter = false;
                    if (selectedStatus === 'available' && statusText === 'verfügbar') {
                        matchesFilter = true;
                    } else if (selectedStatus === 'inuse' && statusText === 'in benutzung') {
                        matchesFilter = true;
                    } else if (selectedStatus === 'maintenance' && statusText === 'in wartung') {
                        matchesFilter = true;
                    }

                    card.style.display = matchesFilter ? '' : 'none';
                });
            });
        }
    });
</script>
</body>
</html>